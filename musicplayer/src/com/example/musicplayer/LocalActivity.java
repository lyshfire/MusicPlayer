package com.example.musicplayer;


import java.io.File;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import com.example.application.MApplication;
import com.example.database.DBHelper;
import com.example.database.MediaUtil;
import com.example.fileinfo.FileInfo;
import com.example.musicplayerservice.PlayerService;
import com.example.myselfview.DisableFavoritePopupWindow;
import com.example.utils.AppConstant;

import android.animation.ObjectAnimator;
import android.animation.PropertyValuesHolder;
import android.annotation.SuppressLint;
import android.app.Activity;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.os.Bundle;
import android.view.GestureDetector;
import android.view.Gravity;
import android.view.MotionEvent;
import android.view.View;
import android.view.Window;
import android.view.GestureDetector.SimpleOnGestureListener;
import android.view.View.OnClickListener;
import android.view.View.OnTouchListener;
import android.view.animation.LinearInterpolator;
import android.widget.AdapterView;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.RadioGroup;
import android.widget.RelativeLayout;
import android.widget.SimpleAdapter;
import android.widget.TextView;
import android.widget.Toast;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.AdapterView.OnItemLongClickListener;
import android.widget.RadioGroup.OnCheckedChangeListener;
import android.widget.ToggleButton;

@SuppressLint("NewApi")
public class LocalActivity  extends Activity{
	
	private ListView songlist_lv = null; // 音乐列表  	
    private List<FileInfo> fileInfos = new ArrayList<FileInfo>();  
    private SimpleAdapter mAdapter = null; // 简单适配器  
    
	private Button return_bt;
	private TextView music_name_tv;
	private TextView music_siger_tv;
	private ToggleButton music_play_bt;
	private Button btn_love;
	private RelativeLayout bottombar_layout;
	private ImageView music_album_iv;
	
	private int listPosition = 0;   //标识列表位置
    private boolean isFirstTime = true;   
    private boolean isPlaying; // 正在播放  
    private boolean isPause; // 暂停 
    private int msg = -1;
    private boolean play_bt_press = false;
    private boolean play_bt_check = false;
    private Intent intentFromMain;
    private PlayerReceiver playerReceiver; //接收PlayerService服务的广播接收器
    private SharedPreferences preferences;
	private Editor editor;
	
	/***********图片动画**************/
	private ObjectAnimator anim;
	private ObjectAnimator animSongName;
	private ObjectAnimator animSongSinger;
	private LinearInterpolator lin;
	
	/************手势****************************/
	GestureDetector  myGestureDetector;
	
	//自定义的弹出框类
	DisableFavoritePopupWindow menuWindow;
	private int localListPosition = -1;   //标识收藏列表位置
	private boolean isAllDelete=false;// false表示删除本首,true表示删除所有
	
	private MApplication appState;
	private  DBHelper helper;
	private  DBHelper helperFavorite;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		requestWindowFeature(Window.FEATURE_NO_TITLE);// 去掉标题栏
		setContentView(R.layout.activity_local);
		
		intentFromMain = getIntent();
		Bundle bundle = intentFromMain.getExtras();
		listPosition = bundle.getInt("listPosition");
		play_bt_press = bundle.getBoolean("bt_press");
		play_bt_check = bundle.getBoolean("bt_check");
		isFirstTime  = bundle.getBoolean("isFirstTime");
		isPlaying  = bundle.getBoolean("isPlaying");
		isPause  = bundle.getBoolean("isPause");
		msg      = bundle.getInt("msg");
		
		preferences = getSharedPreferences("songPosition", MODE_PRIVATE);		
		editor = preferences.edit();
		
		appState = ((MApplication)getApplicationContext());        
		helper = appState.getDBHelper();
		helperFavorite = appState.getDBHelperFavorite();
		fileInfos = appState.getFileInfos();
		
		findViewById(); //从界面上根据id获取控件
		setViewOnclickListener(); //给每一个控件设置监听器
		initLocalMusicList();//初始化歌曲列表	
		
		playerReceiver = new PlayerReceiver();  
        IntentFilter filter = new IntentFilter();  
        filter.addAction(PlayerService.UPDATE_ACTION);      
        filter.addAction(PlayerService.MUSIC_PLAY_PAUSE);
        registerReceiver(playerReceiver, filter); 
        
	}
    
	//从界面上根据id获取按钮
    private void findViewById() { 
    	return_bt = (Button)findViewById(R.id.return_bt);
    	songlist_lv = (ListView)findViewById(R.id.songlist_lv);
    	music_name_tv = (TextView)findViewById(R.id.music_name_tv);
    	music_siger_tv = (TextView)findViewById(R.id.music_siger_tv);   	
    	music_play_bt = (ToggleButton)findViewById(R.id.music_play_bt);
    	music_album_iv = (ImageView)findViewById(R.id.music_album_iv);
    	btn_love            = (Button)findViewById(R.id.btn_love);
    	myGestureDetector = new GestureDetector(new myGestureListener());
    	bottombar_layout = (RelativeLayout)findViewById(R.id.bottombar_layout);
    }
    
  //给每一个控件设置监听器
    private void setViewOnclickListener() {  
    	ViewOnClickListener viewOnClickListener = new ViewOnClickListener();  
    	return_bt.setOnClickListener(viewOnClickListener);
    	music_play_bt.setOnClickListener(viewOnClickListener);
    	music_album_iv.setOnClickListener(viewOnClickListener); 
    	btn_love.setOnClickListener(viewOnClickListener); 
    	songlist_lv.setOnItemClickListener(new MusicListItemClickListener()); //列表监听
    	songlist_lv.setOnItemLongClickListener(new ListItemLongClickListener());//长按删除
    	
    	bottombar_layout.setOnClickListener(viewOnClickListener);
    	bottombar_layout.setOnTouchListener(new OnTouchListener() {	
			//捕获bottombar_layout的触摸事件,并传递给GestureDetector
			@Override
			public boolean onTouch(View v, MotionEvent event) {
				myGestureDetector.onTouchEvent(event);
				return false;
			}
		});
    }
    
    private class myGestureListener  extends SimpleOnGestureListener{
    	Intent intentToService = new Intent("com.example.musicplayerservice.PlayerService");
    	//监听传递过来的触摸事件进行判断
    	@Override
    	public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX,float velocityY) {
    		if(e1.getX() - e2.getX()  > 50){
    	    	msg = AppConstant.PlayerMsg.PLAY_MSG;  
                isFirstTime = false;  
                isPlaying = true;  
                isPause = false;  
                listPosition = listPosition - 1;
                if(listPosition < 0){
                	listPosition = fileInfos.size() - 1;
                }	               
    		}else if(e2.getX() - e1.getX() > 50){    			
    			msg = AppConstant.PlayerMsg.PLAY_MSG;  
                isFirstTime = false;  
                isPlaying = true;  
                isPause = false;  
                listPosition = listPosition + 1;
                if(listPosition > fileInfos.size() - 1){
                	listPosition = 0;
                }
    		}
    		  if (anim != null  &&  isPlaying == true) {  
    	        	if(!anim.isStarted()){
    	       	         anim.start();//开始旋转
    	       	    }else{
    	       		    anim.resume();//继续旋转
    	         	}
    	    	} 
    		 play_bt_press = false;
             play_bt_check = true;
             music_play_bt.setPressed(play_bt_press);
             music_play_bt.setChecked(play_bt_check);
    		FileInfo mp3Info = fileInfos.get(listPosition); 
    		music_siger_tv.setText(fileInfos.get(listPosition).getArtist());  
            music_name_tv.setText(fileInfos.get(listPosition).getTitle());
	        if(helper.getMP3Info(fileInfos.get(listPosition)) == false)	{	    	    	  
	              helper.addMP3InfoDB(fileInfos.get(listPosition));
	    	 }    	       	         	        	             		 	
	        Bundle bundle  = new Bundle();
	        bundle.putInt("listPosition", listPosition);  
	        bundle.putString("url", mp3Info.getUrl());
	    	bundle.putInt("MSG", msg);//将msg存放于bundle中 
	    	intentToService.putExtras(bundle);//将bundle绑定到intent
	        startService(intentToService); 
    		return super.onFling(e1, e2, velocityX, velocityY);
    	}
    }
    
    //自定义的监听器类
    private class ViewOnClickListener implements OnClickListener {   	
    	Intent intentToService = new Intent("com.example.musicplayerservice.PlayerService"); 
		@Override
		public void onClick(View v) {
			switch (v.getId()) {  
			     case R.id.return_bt:   {// 跳到播放界面				         
			    	    Bundle toMainData = new Bundle();
			    	    toMainData.putInt("listPosition", listPosition);
			    	    toMainData.putBoolean("bt_press", false);
			    	    toMainData.putBoolean("bt_check",isPlaying);
			    	    toMainData.putBoolean("isFirstTime", isFirstTime);
			    	    toMainData.putBoolean("isPlaying", isPlaying);
			    	    toMainData.putBoolean("isPause", isPause);
			    	    toMainData.putInt("msg", msg);
			    	    intentFromMain.putExtras(toMainData);
			            LocalActivity.this.setResult(0, intentFromMain); 
			            LocalActivity.this.finish();
				         break;  }
			     case R.id.btn_love:   {// 添加歌曲到收藏夹	
			    	 songFavorite();    	 
			         break;  }
			     case R.id.music_album_iv :  { // 跳到播放界面			          
			         Intent intent = new Intent(LocalActivity.this,PlayingActivity.class);	
			         Bundle toPlayingData = new Bundle();
			         toPlayingData.putInt("listPosition", listPosition);
			         toPlayingData.putBoolean("bt_press", false);
			         toPlayingData.putBoolean("bt_check",isPlaying);
			         toPlayingData.putBoolean("isFirstTime", isFirstTime);
			         toPlayingData.putBoolean("isPlaying", isPlaying);
			         toPlayingData.putBoolean("isPause", isPause);
			         toPlayingData.putInt("msg", msg);
			         intent.putExtras(toPlayingData);			             
			         startActivityForResult(intent, 0);				         
			         break; }   
			     case R.id.music_play_bt:   {//播放音乐
			    	 if(isFirstTime) {                      
		                	msg = AppConstant.PlayerMsg.PLAY_MSG;  
		                    isFirstTime = false;  
		                    isPlaying = true;  
		                    isPause = false; 
		                    play_bt_press = false;
			                play_bt_check = true;
		                    if(helper.getMP3Info(fileInfos.get(listPosition)) == false)	{	    	    	  
			    	              helper.addMP3InfoDB(fileInfos.get(listPosition));
			    	    	 }
		                   anim.start();	
		                   //animSongName.start();
		       	           //animSongSinger.start();
		                    Toast.makeText(LocalActivity.this,"开始播放",Toast.LENGTH_SHORT).show(); 
		                } else {  
		                    if (isPlaying) {  		                                            
		                        msg = AppConstant.PlayerMsg.PAUSE_MSG;   
		                        isPlaying = false;  
		                        isPause = true;   
		                        play_bt_press = false;
				                play_bt_check = false;
		                        anim.pause();	
		                        Toast.makeText(LocalActivity.this,"暂停播放  ",Toast.LENGTH_SHORT).show();  
		                    } else if (isPause) {  
		                        msg = AppConstant.PlayerMsg.CONTINUE_MSG;   
		                        isPause = false;  
		                        isPlaying = true;  
		                        play_bt_press = false;
				                play_bt_check = true;
				                if(!anim.isStarted()){
					       	         anim.start();//开始旋转
					       	    }else{
					       		    anim.resume();//继续旋转
					         	}
				                //animSongName.start();
				    	        //animSongSinger.start();
		                        Toast.makeText(LocalActivity.this,"继续播放",Toast.LENGTH_SHORT).show();  
		                    }  
		                }  
			    	    Intent sendIntent = new Intent(PlayerService.MUSIC_PLAY_STATE);
						sendIntent.putExtra("listPosition", listPosition);	
						sendIntent.putExtra("bt_press", play_bt_press); 
						sendIntent.putExtra("bt_check", play_bt_check);
						sendIntent.putExtra("isFirstTime", isFirstTime);
						sendIntent.putExtra("isPlaying", isPlaying);
						sendIntent.putExtra("isPause", isPause);
						sendIntent.putExtra("msg", msg);	
						sendBroadcast(sendIntent);
			    	   FileInfo mp3Info = fileInfos.get(listPosition);  
			    	   editor.putInt("listPosition", listPosition);
			    	   editor.commit();
			           Bundle bundle  = new Bundle();
			           bundle.putInt("listPosition", listPosition);  
			           bundle.putString("url", mp3Info.getUrl());
			    	   bundle.putInt("MSG", msg);//将msg存放于bundle中 
			    	   intentToService.putExtras(bundle);//将bundle绑定到intent
			           startService(intentToService); 
			           break; }
			}
			
		}     	
    }
    //初始化歌曲列表
    private void initLocalMusicList(){ 
    	//fileInfos = MediaUtil.getFileInfos(getApplicationContext()); //获取歌曲对象集合         
        setListAdpter(MediaUtil.getMusicMaps(fileInfos));//显示歌曲列表        
        music_siger_tv.setText(fileInfos.get(listPosition).getArtist());  
    	music_name_tv.setText(fileInfos.get(listPosition).getTitle());    
    	music_play_bt.setPressed(play_bt_press);
    	music_play_bt.setChecked(play_bt_check);
    	
    	anim = ObjectAnimator.ofFloat(music_album_iv, "rotation", 0, 360);  
    	 lin = new LinearInterpolator();
         anim.setDuration(6000);
         anim.setRepeatCount(-1);
         anim.setRepeatMode(ObjectAnimator.RESTART);
         anim.setInterpolator(lin);  //匀速 
         
         PropertyValuesHolder pvhX = PropertyValuesHolder.ofFloat("alpha", 1f, 0f, 1f);  
         PropertyValuesHolder pvhY = PropertyValuesHolder.ofFloat("scaleX", 1f, 0, 1f);  
         PropertyValuesHolder pvhZ = PropertyValuesHolder.ofFloat("scaleY", 1f, 0, 1f); 
         animSongName = ObjectAnimator.ofPropertyValuesHolder(music_name_tv, pvhX, pvhY,pvhZ); //渐现
         animSongName.setDuration(1000);
         animSongName.setRepeatCount(0);
         animSongName.setRepeatMode(ObjectAnimator.RESTART);
         
        animSongSinger = ObjectAnimator.ofPropertyValuesHolder(music_siger_tv, pvhX, pvhY,pvhZ); //渐现
        animSongSinger.setDuration(1000);
        animSongSinger.setRepeatCount(0);
        animSongSinger.setRepeatMode(ObjectAnimator.RESTART); 
    }
  //显示歌曲列表
    public   void setListAdpter(List<HashMap<String, String>> mp3list) {  
        if(mp3list != null){
        	mAdapter = new SimpleAdapter(LocalActivity.this, mp3list,  
                    R.layout.music_list_item_layout, new String[] {"duration","title","artist"}, 
                    new int[] {R.id.music_duration,R.id.music_title,R.id.music_artist });  
            songlist_lv.setAdapter(mAdapter);
            Toast.makeText(LocalActivity.this, "添加列表成功"+fileInfos.size(), Toast.LENGTH_SHORT).show();
        }else{
        	Toast.makeText(LocalActivity.this, "本地列表没有歌曲", Toast.LENGTH_SHORT).show();
        }       
    }
    
    //点击列表更改播放状态
    private class MusicListItemClickListener implements OnItemClickListener {    
    	Intent intentToService = new Intent("com.example.musicplayerservice.PlayerService");
        @Override  
        public void onItemClick(AdapterView<?> parent, View view, int position,long id) {  
            listPosition = position;   
            FileInfo mp3Info = fileInfos.get(listPosition);  
            msg = AppConstant.PlayerMsg.PLAY_MSG;  
            isFirstTime = false;  
            isPlaying = true;  
            isPause = false;  
            
            play_bt_press = false;
            play_bt_check = true;
            music_play_bt.setPressed(play_bt_press);
            music_play_bt.setChecked(play_bt_check);
            music_siger_tv.setText(mp3Info.getArtist());  
            music_name_tv.setText(mp3Info.getTitle());	    
	        if(helper.getMP3Info(mp3Info) == false)	{	    //添加到最近播放列表	    	  
	              helper.addMP3InfoDB(mp3Info);
	    	 } 	        
           
	        /*************设置旋转*********************************/
	        if (anim != null  &&  isPlaying == true) {  
	        	if(!anim.isStarted()){
	       	         anim.start();//开始旋转
	       	    }else{
	       		    anim.resume();//继续旋转
	         	}
	    	} else{
	    		anim.pause(); //停止旋转
	    	}        
	        //animSongName.start();
	        //animSongSinger.start();
	        
	        Bundle bundle  = new Bundle();
	        bundle.putInt("listPosition", listPosition);  
	        bundle.putString("url", mp3Info.getUrl());
	    	bundle.putInt("MSG", msg);//将msg存放于bundle中 
	    	intentToService.putExtras(bundle);//将bundle绑定到intent
	        startService(intentToService); 
        }   
    }        
    
    private class ListItemLongClickListener implements OnItemLongClickListener{
		@Override
		public boolean onItemLongClick(AdapterView<?> parent, View view, int pos,long id) {  
			localListPosition = pos;			
			//实例化SelectPicPopupWindow
			menuWindow = new DisableFavoritePopupWindow(LocalActivity.this,R.layout.delete_music_dialog,itemsOnClick,RadioGroupOnClick);
			//显示窗口
			menuWindow.showAtLocation(LocalActivity.this.findViewById(R.id.RelativeLayoutLocalActivity), Gravity.CENTER_VERTICAL|Gravity.CENTER_HORIZONTAL, 0, 0); //设置layout在PopupWindow中显示的位置
//			FileInfo mp3Info = mp3InfoLoveList.get(position);		
//			helperFavorite.deleteMP3InfoDB(mp3Info);
//			for(int i=0;i<fileInfos.size();i++){
//		          if(fileInfos.get(i).getTitle().equals(mp3Info.getTitle())){
//		        	  fileInfos.get(i).setFavorite(false);	
//		          }
//			}
//			if(mp3InfoLoveList.remove(position) != null){
//				 setListAdpter(MediaUtil.getMusicMaps(mp3InfoLoveList));
//			     return true;
//			}
			
			
			return false;
		}   	
    }
    
  //设置是否歌曲收藏状态
    private void setFavoriteDefault(){
		 if(helperFavorite.getMP3Info(fileInfos.get(listPosition))){	    	    	  
	        	btn_love.setSelected(true);
	     }else{
	    		 btn_love.setSelected(false);
	      }
    }
  //歌曲收藏与取消收藏
    private void songFavorite(){    	
    	  if(helperFavorite.getMP3Info(fileInfos.get(listPosition))){					
				helperFavorite.deleteMP3InfoDB(fileInfos.get(listPosition));
				for(int i=0;i<fileInfos.size();i++){
			          if(fileInfos.get(i).getTitle().equals(fileInfos.get(listPosition).getTitle())){
			        	  fileInfos.get(i).setFavorite(false);	
			          }
				}      	       
	            btn_love.setSelected(false);
	            Toast.makeText(LocalActivity.this,"取消收藏",Toast.LENGTH_SHORT).show();  
         } else  {    	    	  
    	          helperFavorite.addMP3InfoDB(fileInfos.get(listPosition));
    	          fileInfos.get(listPosition).setFavorite(true);	
    	    	  btn_love.setSelected(true);
    	          Toast.makeText(LocalActivity.this,"收藏成功",Toast.LENGTH_SHORT).show();     	    	         		
         }    	  
    }
    
    
  //用来接收从PlayerService传回来的广播的内部类
    public class PlayerReceiver extends BroadcastReceiver {     	  
        @Override  
        public void onReceive(Context context, Intent intent) {  
            String action = intent.getAction();           
            if(action.equals(PlayerService.UPDATE_ACTION)) {  
                //获取Intent中的current消息，current代表当前正在播放的歌曲  
                listPosition = intent.getIntExtra("current", -1);                    
                if(listPosition >= 0) {                       
                	music_siger_tv.setText(fileInfos.get(listPosition).getArtist());  
                	music_name_tv.setText(fileInfos.get(listPosition).getTitle());      
                	animSongName.start();
         	        animSongSinger.start();
                	if(helper.getMP3Info(fileInfos.get(listPosition)) == false)	{	    	    	  
	    	              helper.addMP3InfoDB(fileInfos.get(listPosition));
	    	    	 }
                }                
            }else if(action.equals(PlayerService.MUSIC_PLAY_PAUSE)){
        	 if (isPlaying) {  		                                            
                 msg = AppConstant.PlayerMsg.PAUSE_MSG;   
                 isPlaying = false;  
                 isPause = true;     
                 play_bt_press = false;
	                play_bt_check = false;
                 anim.pause();
             } else if (isPause) {  
                 msg = AppConstant.PlayerMsg.CONTINUE_MSG;   
                 isPlaying = true; 
                 isPause = false;  	
                 play_bt_press = false;
	             play_bt_check = true;
	          	 anim.resume();//继续旋转
	             animSongName.start();
	             animSongSinger.start();
             }  
        	 music_play_bt.setPressed(play_bt_press);
        	 music_play_bt.setChecked(play_bt_check);    	 
        }  
            setFavoriteDefault();//设置是否歌曲收藏状态
      }            
    }
      
	@Override
	protected void onActivityResult(int requestCode, int resultCode, Intent intent) {
		super.onActivityResult(requestCode, resultCode, intent);
		if(requestCode == 0  && resultCode == 0){
			Bundle fromLocalData = intent.getExtras();
			listPosition = fromLocalData.getInt("listPosition");
			play_bt_press = fromLocalData.getBoolean("bt_press");
			play_bt_check = fromLocalData.getBoolean("bt_check");
			isFirstTime  = fromLocalData.getBoolean("isFirstTime");
			isPlaying  = fromLocalData.getBoolean("isPlaying");
			isPause  = fromLocalData.getBoolean("isPause");
			msg      = fromLocalData.getInt("msg");
			music_siger_tv.setText(fileInfos.get(listPosition).getArtist());  
        	music_name_tv.setText(fileInfos.get(listPosition).getTitle());    
        	music_play_bt.setPressed(play_bt_press);
        	music_play_bt.setChecked(play_bt_check);       	
		}
	}

	@Override
	protected void onResume() {
		// TODO Auto-generated method stub
		super.onResume();
		appState = ((MApplication)getApplicationContext());        
		helper = appState.getDBHelper();
		helperFavorite = appState.getDBHelperFavorite();
		fileInfos = appState.getFileInfos();
		music_play_bt.setPressed(play_bt_press);
    	music_play_bt.setChecked(play_bt_check);    
    	setFavoriteDefault();//设置是否歌曲收藏状态
		 if (anim != null  &&  isPlaying == true) {  
	        	if(!anim.isStarted()){
	       	         anim.start();//开始旋转
	       	    }else{
	       		    anim.resume();//继续旋转
	         	}
	    	} else{
	    		anim.pause(); //停止旋转
	    	}
	}

    
	//为弹出窗口实现监听类
    private OnClickListener  itemsOnClick = new OnClickListener(){
		public void onClick(View v) {
			menuWindow.dismiss();
			switch (v.getId()) {
			case R.id.btn_cancel:
				break;
			case R.id.btn_ok:	{	
				if(!isAllDelete){ //删除本首歌曲			
					 deleteSdFile(fileInfos.get(localListPosition).getUrl());//删除歌曲和歌词文件
					 appState.deleteMediaDB(LocalActivity.this,fileInfos.get(localListPosition));//删除数据库的记录
					 fileInfos.remove(localListPosition);//删除列表项
					 setListAdpter(MediaUtil.getMusicMaps(fileInfos));	//重新显示		
				}
				break;}
			default:
				break;
			}				
		}   	
    };
    
    private OnCheckedChangeListener RadioGroupOnClick = new OnCheckedChangeListener(){
		@Override
		public void onCheckedChanged(RadioGroup group, int checkedId) {
			// TODO Auto-generated method stub
			if (checkedId == R.id.rb_all) {
				isAllDelete = true;
				menuWindow.getView().setText("歌曲歌词都删除吗?");
			}else{
				isAllDelete = false;
				menuWindow.getView().setText("删除\"" + fileInfos.get(localListPosition).getTitle() +"\"?" + "\r"
				                                                  + fileInfos.get(localListPosition).getUrl() );
			}
		}  	
    };
    private void deleteSdFile(String path){
    	 File deleteMp3File = new File(	path); 	
    	 File deleteLyricFile = new File(appState.getFileNameNoEx(path) + ".lrc"); 	
		 deleteMp3File.delete(); //删除音乐文件
		 deleteLyricFile.delete();//删除歌词文件
    }
    
}
